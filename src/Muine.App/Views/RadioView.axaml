<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Muine.App.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Muine.App.Views.RadioView"
             x:DataType="vm:RadioViewModel">
    
    <Grid RowDefinitions="Auto,*" ColumnDefinitions="250,*">
        <!-- Search and Controls -->
        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="10" Spacing="10">
            <TextBox Name="SearchBox" 
                     Text="{Binding SearchQuery}" 
                     Watermark="Search stations..." 
                     Width="300"/>
            <Button Content="Search" Name="SearchButton" Click="OnSearchClick"/>
            <Button Content="Add Station" Name="AddStationButton" Click="OnAddStationClick"/>
            <Button Content="Refresh" Name="RefreshButton" Click="OnRefreshClick"/>
        </StackPanel>

        <!-- Category Tree -->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="Gray" BorderThickness="0,0,1,0" Padding="5">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Categories" FontWeight="Bold" Margin="5,0,0,10"/>
                <TreeView Name="CategoryTree" 
                          ItemsSource="{Binding CategoryTree}"
                          SelectedItem="{Binding SelectedCategory}">
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock Text="{Binding Name}"/>
                                <TextBlock Text="{Binding Stations.Count, StringFormat='({0})'}" 
                                           Foreground="Gray"
                                           IsVisible="{Binding HasStations}"/>
                            </StackPanel>
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </DockPanel>
        </Border>

        <!-- Stations List -->
        <Border Grid.Row="1" Grid.Column="1" Padding="5">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" 
                           Text="{Binding StatusMessage}" 
                           Margin="5,0,0,10"
                           Foreground="Gray"/>
                
                <DataGrid x:Name="StationsGrid"
                          ItemsSource="{Binding Stations}"
                          SelectedItem="{Binding SelectedStation}"
                          IsReadOnly="True"
                          AutoGenerateColumns="False"
                          GridLinesVisibility="Horizontal"
                          CanUserResizeColumns="True"
                          MinHeight="200">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150"/>
                        <DataGridTextColumn Header="Genre" Binding="{Binding Genre}" Width="Auto" MinWidth="80"/>
                        <DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="Auto" MinWidth="80"/>
                        <DataGridTextColumn Header="Bitrate" Binding="{Binding Bitrate, StringFormat='{}{0} kbps'}" Width="Auto" MinWidth="60"/>
                        <DataGridTextColumn Header="Category" Binding="{Binding FullCategory}" Width="Auto" MinWidth="100"/>
                    </DataGrid.Columns>
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Play" Name="PlayMenuItem" Click="OnPlayStationClick"/>
                            <MenuItem Header="Edit" Name="EditMenuItem" Click="OnEditStationClick"/>
                            <Separator/>
                            <MenuItem Header="Delete" Name="DeleteMenuItem" Click="OnDeleteStationClick"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                </DataGrid>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
